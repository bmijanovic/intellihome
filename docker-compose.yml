version: '3.8'
services:
  postgres:
    image: postgres
    container_name: postgres
    restart: always
    environment:
      POSTGRES_USER: intellihome_user
      POSTGRES_PASSWORD: intellihome_password
      POSTGRES_DB: intellihome_sql
    ports:
      - "5432:5432"
    working_dir: /var/lib/postgresql/data
    volumes:
      - Postgres:/var/lib/postgresql/data
    tty: true

  influxdb:
    image: influxdb
    container_name: influxdb
    restart: always
    ports:
      - "8086:8086"
    working_dir: /var/lib/influxdb
    volumes:
      - Influxdb:/etc/influxdb/influxdb
    tty: true

  mosquitto:
    image: eclipse-mosquitto
    container_name: mosquitto
    ports:
      - "1883:1883"
      - "9001:9001"
    environment:
      - MQTT_CONFIG=/mosquitto/config/mosquitto.conf
    volumes:
      - ./Mosquitto/config:/mosquitto/config
      - ./Mosquitto/data:/mosquitto/data
      - ./Mosquitto/log:/mosquitto/log
    networks:
      - mqtt
    tty: true

  # device_simulator:
  #   image: tiangolo/uvicorn-gunicorn-fastapi:python3.11
  #   container_name: device_simulator
  #   restart: always
  #   ports:
  #     - "80:80"
  #   volumes:
  #     - ./DeviceSimulator:/app
  #   tty: true

  # react_frontend:
  #   image: node:alpine
  #   container_name: react_frontend
  #   restart: always
  #   ports:
  #     - 8000:8000
  #   working_dir: /srv/app
  #   volumes:
  #     - type: bind
  #       source: ./IntelliHome-Frontend
  #       target: /srv/app
  #   tty: true
  #   command: sh -c "npm install && npm run dev"

  # dotnet_backend:
  #   image: mcr.microsoft.com/dotnet/sdk:6.0
  #   container_name: dotnet_backend
  #   restart: always
  #   ports:
  #     - 5283:5283
  #   working_dir: /app
  #   volumes:
  #     - type: bind
  #       source: ./IntelliHome-Backend/IntelliHome-Backend
  #       target: /app
  #   tty: true
  #   command: sh -c "./wait-for-postgres.sh"
  #   depends_on:
  #     - postgres


volumes:
  Postgres:
  Influxdb:
  Mosquitto:
  DeviceSimulator:

networks:
  mqtt: